/*
 * knockout-kendo v0.6
 * Copyright Â© 2013 Ryan Niemeyer & Telerik
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); 
 * you may not use this file except in compliance with the License. 
 * You may obtain a copy of the License at

 * http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software 
 * distributed under the License is distributed on an "AS IS" BASIS, 
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
 * See the License for the specific language governing permissions and 
 * limitations under the License.
 */
(function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("knockout"),require("jquery"),require("kendo")):"function"==typeof define&&define.amd?define(["knockout","jquery","kendo"],e):e(window.ko,window.jQuery,window.kendo)})(function(e,n,a,t){e.kendo=e.kendo||{},e.kendo.BindingFactory=function(){var a=this;this.createBinding=function(o){if(n()[o.parent||o.name]){var i={};i.init=function(e,n,l,d,s){var r=a.buildOptions(o,n);return r.async===!0||o.async===!0&&r.async!==!1?(setTimeout(function(){i.setup(e,r,s)},0),t):(i.setup(e,r,s),r&&r.useKOTemplates?{controlsDescendantBindings:!0}:t)},i.setup=function(t,i,l){var d,s=n(t);a.setupTemplates(o.templates,i,t,l),d=a.getWidget(o,i,s),a.handleEvents(i,o,t,d),a.watchValues(d,i,o,t),d.destroy&&e.utils.domNodeDisposal.addDisposeCallback(t,function(){d.destroy()})},i.options={},i.widgetConfig=o,e.bindingHandlers[o.bindingName||o.name]=i}},this.buildOptions=function(n,a){var t=n.defaultOption,o=e.utils.extend({},e.bindingHandlers[n.name].options),i=e.utils.unwrapObservable(a());return"object"!=typeof i||null===i||t&&!(t in i)?o[t]=a():e.utils.extend(o,i),o};var o=function(n,a){return function(t){return e.renderTemplate(n,a.createChildContext(t._raw&&t._raw()||t))}};this.setupTemplates=function(n,a,t,i){var l,d,s,r;if(n&&a&&a.useKOTemplates){for(l=0,d=n.length;d>l;l++)s=n[l],a[s]&&(a[s]=o(a[s],i));r=a.dataBound,a.dataBound=function(){e.memoization.unmemoizeDomNodeAndDescendants(t),r&&r.apply(this,arguments)}}},this.getWidget=function(n,a,t){var o;if(n.parent){var i=t.closest("[data-bind*='"+n.parent+":']");o=i.length?i.data(n.parent):null}else o=t[n.name](e.toJS(a)).data(n.name);return e.isObservable(a.widget)&&a.widget(o),o},this.watchValues=function(e,n,t,o){var i,l=t.watch;if(l)for(i in l)l.hasOwnProperty(i)&&a.watchOneValue(i,e,n,t,o)},this.watchOneValue=function(a,o,i,l,d){var s=e.computed({read:function(){var s,r,u=l.watch[a],c=e.utils.unwrapObservable(i[a]),p=l.parent?[d]:[];n.isArray(u)?u=o[c?u[0]:u[1]]:"string"==typeof u?u=o[u]:r=!0,u&&i[a]!==t&&(r?p.push(c,i):(s=u.apply(o,p),p.push(c)),(r||s!==c)&&u.apply(o,p))},disposeWhenNodeIsRemoved:d});e.isObservable(i[a])||s.dispose()},this.handleEvents=function(n,t,o,i){var l,d,s=t.events;if(s)for(l in s)s.hasOwnProperty(l)&&(d=s[l],"string"==typeof d&&(d={value:d,writeTo:d}),e.isObservable(n[d.writeTo])&&a.handleOneEvent(l,d,n,o,i,t.childProp))},this.handleOneEvent=function(e,n,a,t,o,i){o.bind(e,function(e){var o,l;i&&e[i]&&e[i]!==t||(o=n.value,l="string"==typeof o&&this[o]?this[o](i&&t):o,a[n.writeTo](l))})}},e.kendo.bindingFactory=new e.kendo.BindingFactory,e.kendo.setDataSource=function(n,a,t){var o,i;t&&t.useKOTemplates||(o=e.mapping&&a&&a.__ko_mapping__,i=a&&o?e.mapping.toJS(a):e.toJS(a)),n.dataSource.data(i||a)},function(){var e=a.data.ObservableArray.fn.wrap;a.data.ObservableArray.fn.wrap=function(n){var a=e.apply(this,arguments);return a._raw=function(){return n},a}}();var o=function(n){return function(a){a&&(e.utils.extend(this.options[n],a),this.redraw(),this.value(.001+this.value()))}},i=e.kendo.bindingFactory.createBinding.bind(e.kendo.bindingFactory),l="close",d="collapse",s="content",r="data",u="enable",c="expand",p="expanded",h="filter",v="isOpen",m="max",w="min",f="open",k="palette",g="search",b="selected",T="size",y="title",O="value",x="values";i({name:"kendoAutoComplete",events:{change:O,open:{writeTo:v,value:!0},close:{writeTo:v,value:!1}},watch:{enabled:u,search:[g,l],data:function(n){e.kendo.setDataSource(this,n)},value:O}}),i({name:"kendoCalendar",defaultOption:O,events:{change:O},watch:{max:m,min:w,value:O}}),i({name:"kendoColorPicker",events:{change:O,open:{writeTo:v,value:!0},close:{writeTo:v,value:!1}},watch:{enabled:u,value:O,color:O,palette:k}}),i({name:"kendoComboBox",events:{change:O,open:{writeTo:v,value:!0},close:{writeTo:v,value:!1}},watch:{enabled:u,isOpen:[f,l],data:function(n){e.kendo.setDataSource(this,n)},value:O}}),i({name:"kendoDatePicker",defaultOption:O,events:{change:O,open:{writeTo:v,value:!0},close:{writeTo:v,value:!1}},watch:{enabled:u,max:m,min:w,value:O,isOpen:[f,l]}}),i({name:"kendoDateTimePicker",defaultOption:O,events:{change:O,open:{writeTo:v,value:!0},close:{writeTo:v,value:!1}},watch:{enabled:u,max:m,min:w,value:O,isOpen:[f,l]}}),i({name:"kendoDropDownList",events:{change:O,open:{writeTo:v,value:!0},close:{writeTo:v,value:!1}},watch:{enabled:u,isOpen:[f,l],data:function(n){e.kendo.setDataSource(this,n)},value:O}}),i({name:"kendoEditor",defaultOption:O,events:{change:O},watch:{enabled:u,value:O}}),i({name:"kendoGrid",defaultOption:r,watch:{data:function(n,a){e.kendo.setDataSource(this,n,a)}},templates:["rowTemplate","altRowTemplate"]}),i({name:"kendoListView",defaultOption:r,watch:{data:function(n,a){e.kendo.setDataSource(this,n,a)}},templates:["template"]}),i({name:"kendoMenu",async:!0}),i({name:"kendoMenuItem",parent:"kendoMenu",watch:{enabled:u,isOpen:[f,l]},async:!0}),i({name:"kendoMultiSelect",events:{change:O,open:{writeTo:v,value:!0},close:{writeTo:v,value:!1}},watch:{enabled:u,search:[g,l],data:function(n){e.kendo.setDataSource(this,n)},value:O}}),i({name:"kendoNumericTextBox",defaultOption:O,events:{change:O},watch:{enabled:u,value:O,max:function(e){this.options.max=e,this.value()>e&&this.value(e)},min:function(e){this.options.min=e,e>this.value()&&this.value(e)}}}),i({name:"kendoPanelBar",async:!0}),i({name:"kendoPanelItem",parent:"kendoPanelBar",watch:{enabled:u,expanded:[c,d]},childProp:"item",events:{expand:{writeTo:p,value:!0},collapse:{writeTo:p,value:!1}},async:!0}),i({name:"kendoRangeSlider",defaultOption:x,events:{change:x},watch:{values:x,enabled:u}}),i({name:"kendoSlider",defaultOption:O,events:{change:O},watch:{value:O,enabled:u}}),i({name:"kendoSplitter",async:!0}),i({name:"kendoSplitterPane",parent:"kendoSplitter",watch:{max:m,min:w,size:T,expanded:[c,d]},childProp:"pane",events:{collapse:{writeTo:p,value:!1},expand:{writeTo:p,value:!0},resize:T},async:!0}),i({name:"kendoTabStrip",async:!0}),i({name:"kendoTab",parent:"kendoTabStrip",watch:{enabled:u},childProp:"item",async:!0}),i({name:"kendoTooltip",events:{},watch:{content:s,filter:h}}),i({name:"kendoTimePicker",defaultOption:O,events:{change:O},watch:{max:m,min:w,value:O,enabled:u,isOpen:[f,l]}}),i({name:"kendoTreeView",async:!0}),i({name:"kendoTreeItem",parent:"kendoTreeView",watch:{enabled:u,expanded:[c,d],selected:function(e,n){this.select(n?e:null)}},childProp:"node",events:{collapse:{writeTo:p,value:!1},expand:{writeTo:p,value:!0},select:{writeTo:b,value:!0}},async:!0}),i({name:"kendoUpload",watch:{enabled:u}}),i({async:!0,name:"kendoWindow",events:{open:{writeTo:v,value:!0},close:{writeTo:v,value:!1}},watch:{content:s,title:y,isOpen:[f,l]}}),i({name:"kendoChart",watch:{data:function(n){e.kendo.setDataSource(this,n)}}}),i({name:"kendoLinearGauge",defaultOption:O,watch:{value:O,gaugeArea:o("gaugeArea"),pointer:o("pointer"),scale:o("scale")}}),i({name:"kendoRadialGauge",defaultOption:O,watch:{value:O,gaugeArea:o("gaugeArea"),pointer:o("pointer"),scale:o("scale")}})});